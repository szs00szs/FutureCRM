<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.future.hist.crm.dao.SalesOrderMapper">

	<resultMap type="com.future.hist.crm.domain.SalesOrder" id="salesOrderMap">
		<id column="id" property="id" />
		<result column="saleNumber" property="saleNumber" />
		<result column="createTime" property="createTime" />
		<result column="deliveryAddress" property="deliveryAddress" />
		<result column="contactPhone"  property="contactPhone" />
		<result column="remark" property="remark" />
		<result column="goods" property="goods" />

		<!-- 关联信息的映射 -->
		<association property="salesman" column="salesman_id" select="getSalesman" />
		<association property="customer" column="customer_id" select="getCustomer"/>
		<association property="contacts" column="contacts_id" select="getContacts"/>
	</resultMap>
	
	<select id="getSalesman" parameterType="java.lang.Long" resultType="com.future.hist.crm.domain.User">
		select * from sysuser where id = #{id}
	</select>
	
	<select id="getCustomer" parameterType="java.lang.Long" resultType="com.future.hist.crm.domain.Customer">
		select * from customer where id = #{id}
	</select>
	
	<select id="getContacts" parameterType="java.lang.Long" resultType="com.future.hist.crm.domain.Contacts">
		select * from contacts  where id = #{id}
	</select>
	
	


	<!-- 查询所有销售记录 -->
	<select id="findOrdersList" resultMap="salesOrderMap">
		SELECT * FROM saleorder
	</select>

	<select id="findOrderById" parameterType="int" resultMap="salesOrderMap">
		SELECT * FROM saleorder s WHERE s.id=#{id}
	</select>
	

	<!-- 取得记录的总数 -->
	<select id="getOrdersCount" resultType="Integer">
		SELECT COUNT(*) FROM
		saleorder
	</select>
	
	<!-- 添加新订单 -->
	<insert id="addOrder" parameterType="com.future.hist.crm.domain.SalesOrder">
	INSERT INTO
	saleorder(saleNumber,createTime,contactPhone,deliveryAddress,remark,goods,salesman_id,customer_id,contacts_id)
	VALUES(#{saleNumber},#{createTime},#{contactPhone},#{deliveryAddress},#{remark},#{goods},#{salesman.id},#{customer.id},#{contacts.id})
	</insert>
	
	
	<!-- 删除订单 -->
	<delete id="deleteOrderById" parameterType="int">
		DELETE FROM saleorder WHERE id = #{id}
	</delete>
	
	<!-- 修改订单 -->
	<update id="editOrder" parameterType="com.future.hist.crm.domain.SalesOrder">
		
	</update>
	
</mapper>